# **Digital recognition** #
## 利用ov5640摄像头采集图像，并利用4.3寸RGB屏显示捕获到的数字，并将识别到的数字显示在数码管上 ##

## **介绍：** ##

 PLL模块
- 
- PLL模块输入时钟为50MHZ，输出3个时钟，分别是100MHZ（供SDRAM模块）、100MHZ，-75°（供SDRAM外设使用）、100MHZ（供I2C模块和LCD模块使用）

cmos_capture模块
-
1. 时钟使用ov5640自带的24MHZ晶振
2. 寄存器全部配置完成后，先等待10帧数据，待寄存器配置生效后再开始采集图像
3. 摄像头采集到的数据是8位的，需转成16位的RGB565数据，才能写入SDRAM
4. 产生16位数据之后，就拉高输出数据有效信号，作为SDRAM的写使能信号

 SDRAM模块
-
- 此模块由2个子模块构成：FIFO读写模块、SDRAM控制器模块

**FIFO读写模块**

1. FIFO读写控制模块，主要分别负责与摄像头和LCD模块进行通信，即读入摄像头的数据，并将读出的数据发送到LCD模块
2. FIFO控制模块中，使用乒乓存储，转换读写的bank地址，完成读写操作

**SDRAM控制器模块**

1. SDRAM控制器模块由3个子模块构成：SDRAM状态控制模块、SDRAM命令控制模块、SDRAM数据读写模块
2. SDRAM状态控制模块：完成SDRAM初始化和工作状态机的状态控制
3. SDRAM命令控制模块：在初始化和工作状态机下各个阶段，对连接着外设SDRAM的控制信号线、L-Bank地址线、地址总线赋值，使之执行相应操作
4. SDRAM数据读写模块：根据工作状态机的输出状态指示，决定是执行读操作还是写操作。写操作时，将待写入数据送到SDRAM数据总线上；读数据时,双向数据线作为输入时保持高阻态，寄存SDRAM数据线上的数据

LCD模块
- 
- 此模块由3个子模块构成：LCD显示屏ID识别模块、时钟分频模块、LCD驱动模块

**LCD显示屏ID识别模块**

- 为了识别使用的LCD屏幕，对输入的16位数据的第4、10、15位进行读取，识别连接的显示屏的尺寸和分辨率

**时钟分频模块**

- 对输入LCD模块的100MHZ时钟进行分频，得到10MHZ、33.3MHZ和50MHZ的时钟，以适配不同尺寸和分辨率的LCD屏幕

**LCD驱动模块**

1. 在数据有效的时候，拉高LCD输入使能信号，将数据传送到LCD显示
2. 采用逐行扫描显示模式，在对应的像素点输入对应的数据信号
3. 不同LCD尺寸和分辨率对应的行场时序参数不同
4. 输出一个data\_ req信号，连接到SDRAM的rd\_en信号，请求读取数据
5. 输出一个dri\_clk时钟，给到I2C配置模块

Picture_size模块
- 
- 根据LCD读取到的LCD屏幕ID，输出图像的尺寸大小和SDRAM读写操作最大地址

I2C配置模块
- 
1. 根据输入的图像的尺寸大小信息，输出摄像头的寄存器配置所需的参数，即I2C驱动模块要配置的地址与数据（16位地址，8位数据）
2. 单个寄存器配置完成后，会发出一个配置完成信号
3. 所有寄存器配置完成后，会发出一个初始化完成信号

I2C驱动模块
- 
1. 根据输入的配置参数，通过控制scl和sda线，完成对ov5640摄像头的配置
2. 将I2C的读写控制信号拉低，即只进行写操作，而不读取数据
3. 输出I2C的SCL时钟信号，不能大于400khz，取250khz

VIP模块（video image process）
- 
- 此模块由4个子模块构成：rgb转ycbcr模块、二值化模块、投影模块、数字识别模块

**rgb转ycbcr模块**

- LCD模块给出来的数据是rgb565格式的，要把它的亮度信息提取出来，方便后面的数据处理操作。所以把rgb565先转成rgb888格式的数据，再转换成ycbcr格式的数据。后续操作只需要用到y（亮度信息）

**二值化模块**

- 对rgb转ycbcr模块输出的数据进行二值化操作，判断阈值设置为64

**投影模块**

1. 对数据进行水平和垂直投影，从而实现对图像的分割
2. 分别根据行和列的像素累加值，就可以判断行数和列数，并能判断出数字的位置
3. 判断到数字的位置之后，把它的边界信息放进ram中存储，待后续操作使用

**数字识别模块**

1. 投影模块得到数字的边界信息之后，对数字进行分割操作：垂直方向划分成3个区域，分别在2/5和2/3处画一条横线；水平方向则平均分成2个区域。然后，进行特征匹配操作，识别出对应的数字
2. 输出一个color_rgb信号，显示在LCD屏幕上，显示内容为二值化后的图像和数字的边界
3. 另外，还输出一个digit信号，将识别到的数字显示在数码管上
